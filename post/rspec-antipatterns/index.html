<html lang="en">
<head>

  
  <meta charset="utf-8">
  <title>RSpec and the Four Phase Tests</title>
  <meta name="description" content="RSpec and the Four Phase Tests">
  <meta name="author" content="emmanuel delgado">

  
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="//chischaschos.github.io/css/fonts.css">
  
  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
  

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">

  <link rel="stylesheet" href="//chischaschos.github.io/css/custom.css">

  
  
  <link rel="stylesheet" href="//chischaschos.github.io/highlight/styles/solarized_light.css">
  
  <script src="//chischaschos.github.io/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

</head>
<body>


<div class="header pure-g">
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
    <div class="pure-u-11-12 pure-u-md-5-8">
        <div class="desktop pure-menu pure-menu-horizontal nav-menu">
            
            <a href="//chischaschos.github.io/" class="site-title pure-menu-heading">chischaschos rocks</a>
            <ul class="pure-menu-list">
                
                <li class="pure-menu-item">
                    <a href="//chischaschos.github.io/categories/pending-research" class="pure-menu-link">Pending-Research</a>
                </li>
                
                <li class="pure-menu-item">
                    <a href="//chischaschos.github.io/categories/talks" class="pure-menu-link">Talks</a>
                </li>
                
                <li class="pure-menu-item">
                    <a href="//chischaschos.github.io/about/" class="pure-menu-link">About</a>
                </li>
            </ul>
        </div>
        <div class="mobile pure-menu nav-menu">
            <a href="/" class="pure-menu-heading" id="toggle-home">chischaschos rocks</a>
            <a href="#" id="toggle-btn">&#9776;</a>
            <ul class="pure-menu-list" id="toggle-content" style="display:none;">
                
                
                <li class="pure-menu-item">
                    <a href="//chischaschos.github.io/categories/pending-research" class="pure-menu-link">Pending-Research</a>
                </li>
                
                <li class="pure-menu-item">
                    <a href="//chischaschos.github.io/categories/talks" class="pure-menu-link">Talks</a>
                </li>
                
                <li class="pure-menu-item">
                    <a href="//chischaschos.github.io/about" class="pure-menu-link">About</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="pure-u-1-24 pure-u-md-1-6"></div>
</div>


<div class="pure-g">
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
  <div class="pure-u-11-12 pure-u-md-5-8">
        <div class="post">

            <div class="post-title">
                <p class="footnote">
                    <time class="">2016-02-07</time>
                
                    
                    |
                    
                    
                    tags:<a href="//chischaschos.github.io/tags/rspec">rspec</a> <a href="//chischaschos.github.io/tags/testing">testing</a> <a href="//chischaschos.github.io/tags/best-practices">best practices</a> 
                    

                    
                    categories:<a href="//chischaschos.github.io/categories/pending-research">pending-research</a> 
                    

                    
                </p>
                <h1>RSpec and the Four Phase Tests</h1>
            </div>

            <div class="post-content">
                

<h2 id="motivation">Motivation</h2>

<p>I want to know what are the best practices to write RSpec tests when striving for a Four Phase Test.</p>

<h2 id="what-the-internet-says-about-it">What the internet says about it?</h2>

<ul>
<li><a href="https://thoughtbot.com/upcase/videos/four-phases-of-testing">https://thoughtbot.com/upcase/videos/four-phases-of-testing</a>.</li>
<li><a href="https://robots.thoughtbot.com/how-we-test-rails-applications">https://robots.thoughtbot.com/how-we-test-rails-applications</a></li>
<li><a href="http://code.tutsplus.com/articles/rspec-testing-for-beginners-part-1--cms-26716">http://code.tutsplus.com/articles/rspec-testing-for-beginners-part-1--cms-26716</a></li>
<li><a href="http://www.justinweiss.com/articles/writing-better-tests-with-the-three-phase-pattern/">http://www.justinweiss.com/articles/writing-better-tests-with-the-three-phase-pattern/</a></li>
</ul>

<h2 id="notes">Notes</h2>

<ul>
<li><code>let</code> may be lazy and convenient.</li>
<li>If another developer comes and looks at the <code>it</code>, he will see a mystery guest.</li>
<li>You create a DSL within RSpec, DSL puzzle.</li>
<li>Each piece of indirection improves high level view, but makes it more complex when you have to change it.</li>
<li>Tests start by setting up the test and then abstract enough so you remove the unimportant details into a factory.</li>
<li>Start with methods, then classes if shared among tests, then the big guns like <code>let</code> and finally shared examples.</li>
<li>You don&rsquo;t want to rebuild what a <code>let</code> does, like memoize.</li>
<li>If you see duplication in your tests it may mean a DRY design issue.</li>
<li><code>subject</code> is a less descriptive version of <code>let</code>, a <code>let</code> without a name.</li>
<li><code>subject</code> is good for <a href="https://github.com/thoughtbot/shoulda">shoulda</a> matchers, not descriptive, good for one liners.</li>
</ul>

<h2 id="personal-experience">Personal experience</h2>

<p>When I read a test I want to understand its structure and dependencies, but
the most important thing I want is to to understand what is the behavior
that a test exercises.</p>

<p>The usual path to understand tests is to:</p>

<ul>
<li>Run specs formatted as documentation</li>
<li>For a specific test:

<ul>
<li>Identify how to trigger/exercise the test</li>
<li>Understand the expectations of the test</li>
<li>Ponder if the description and context semantically matches what we
are exercising in the test</li>
</ul></li>
<li>Additionally for a specific test:

<ul>
<li>Understand what is the minimum required data to make it pass</li>
<li>Identify what are the dependencies and preconditions</li>
</ul></li>
</ul>

<p>RSpec can be abused as any other tools, I don&rsquo;t see how declaring nested lets or multiple lets that expand across 40 lines would help me understand
the aforementioned ideas. At the same time if I see multiple lets it
suggests me that all of them are important to understand the expectations
and purpose of a test, and if this is true, then the test may be too
complex and have many dependencies.</p>

<p>That said, is there another way?</p>

<p>There is, we could use cucumber to express the intentions of the code in
plain english, but then we are talking about introducting a new tool, and
we don&rsquo;t need it, we already have ruby, why don&rsquo;t we simply do ruby?</p>

<p>This means that we can still use rspec and use verbose function names
and high level abstraction concepts in single specifications.</p>

<p>An specification only introduces the high level dependencies that are
needed to execute our test and it also introduces high level expectations
definitions. Every other detail is gonna live inside ruby functions that
will play the role of a domain data factory library.</p>

                
<div id="disqus_thread"></div>
<script>
(function() {
var d = document, s = d.createElement('script');

s.src = '//chischaschos-rocks.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


            </div>
        </div>
  </div>
    <div class="pure-u-1-24 pure-u-md-1-6"></div>
</div>

<div class="footer pure-g">
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
    <div class="pure-u-11-12 pure-u-md-5-8">
        <div class="pure-menu pure-menu-horizontal footer-content">
            <ul>
                <li class="pure-menu-heading" id="foot-name">emmanuel delgado:</li>

                

                
                <li class="pure-menu-item">
                    <a href="https://github.com/chischaschos" class="pure-menu-link">GitHub</a>
                </li>
                

                
                <li class="pure-menu-item">
                    <a href="https://www.linkedin.com/in/emmanueldelgado" class="pure-menu-link">LinkedIn</a>
                </li>
                

                

                
                <li class="pure-menu-item">
                    <a href="https://twitter.com/chischaschos" class="pure-menu-link">Twitter</a>
                </li>
                

            </ul>
            <a href="#" class="pure-menu-heading pull-right" id="gototop-btn">↑↑</a>
        </div>
	  </div>
      <div class="pure-u-1-24 pure-u-md-1-6"></div>
</div>


<script src="//chischaschos.github.io/js/jquery.min.js" type="text/javascript"></script>
<script src="//chischaschos.github.io/js/jquery.timeago.js" type="text/javascript"></script>
<script type="text/javascript">
  $(function(){
    $("time.timeago").timeago();
  })
  $("#toggle-btn").click(function(){
    $("#toggle-content").toggle();
    if($(this).html() === "☰") {
        $(this).html("X")
    } else {
        $(this).html("☰")
    }
  });
  $(window).resize(function(){
    if(window.innerWidth > 768) {
      $(".desktop").removeAttr("style");
    }
  });
</script>

</body>
</html>

